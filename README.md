# 更好的自动回复 (Better Auto-Reply)

**更好的自动回复 (Better Auto-Reply)** 是一个为 [AstrBot](https://github.com/AstrBotDevs/AstrBot) 设计的智能回复增强插件。它旨在改变传统机器人“逢@必回”的机械行为模式，通过引入大语言模型（LLM）进行决策，赋予其自主判断是否需要回复的能力，让您的机器人交互更加智能、自然且人性化。

## 🤔 解决什么问题？

传统的聊天机器人通常基于简单的关键词或@提及来触发回复。这种模式虽然可靠，但也导致了几个问题：
- **机械性回复**：机器人对所有提及它的消息都做出回应，即使那些消息只是随口的感叹或无关的讨论，这让机器人显得很“笨”。
- **信息过载**：在活跃的群聊中，机器人的频繁回复可能会干扰正常对话，造成信息刷屏。
- **缺乏“情商”**：机器人无法理解对话的微妙之处，比如用户是在直接提问，还是仅仅在开玩笑或发表感慨。

本插件通过一个**“先思考，再回复”**的两阶段流程来解决这些问题，让机器人学会“看情况说话”。

## ✨ 功能特性

- **智能决策核心**：对于每一条可能需要回复的消息，插件都会先让 LLM 进行分析，判断消息的真实意图，而不是草率地直接回复。
- **透明的思考过程**：LLM 的完整决策逻辑，包括它对消息的分析和最终的回复意向（是/否），都会被清晰地打印到 AstrBot 的控制台。这让管理员可以直观地了解机器人“在想什么”，并据此调整其行为。
- **选择性回复**：只有当 LLM 认为消息值得回应时，插件才会生成并发送消息。如果 LLM 认为消息无需理会，它会选择静默，避免不必要的打扰。
- **高度可配置的“个性”**：插件的核心决策逻辑由一个 Prompt 模板驱动，用户可以完全自定义这个模板，从而塑造出不同“性格”的机器人——有的热情健谈，有的高冷审慎。
- **关键词触发**：除了被@，您还可以设置一组关键词。当消息包含这些词时，同样会触发插件的分析流程。

## ⚙️ 工作流程

插件的运行逻辑分为两个阶段：

1.  **触发阶段**：插件会监听所有群聊消息。当一条消息满足以下任一条件时，触发分析流程：
    * 机器人被 **@**。
    * 消息内容包含了您在配置中设定的**关键词**（如 "机器人", "bot" 等）。

2.  **决策阶段**：一旦被触发，插件并不会立刻回复。它会将消息内容、是否被@等信息，通过一个特殊的 **决策Prompt** 发送给 LLM，并要求 LLM 完成两件事：
    * **分析消息**：理解用户的意图。
    * **做出决策**：以 JSON 格式返回是否应该回复（`should_reply`）以及做出此判断的理由（`reasoning`）。

3.  **执行阶段**：
    * 插件解析 LLM 返回的 JSON。
    * 将完整的思考过程和回复意向打印到**控制台**。
    * 如果 `should_reply` 为 `true`，则将原始消息交由 AstrBot 的标准流程处理，生成并发送回复。
    * 如果 `should_reply` 为 `false`，则流程终止，机器人保持沉默。

## 🛠️ 安装方式

本插件已在 AstrBot 官方插件市场发布。

您只需进入 AstrBot 的 WebUI，在 **“插件”** -> **“插件市场”** 中搜索 **“Better Auto-Reply”** 或 **“更好的自动回复”**，点击安装即可。

## 📝 配置指南

安装插件后，请务必进入 AstrBot WebUI 的 **“插件”** 页面，找到 **“更好的自动回复”** 并点击 **“配置”**。

| 配置项 | 类型 | 描述 |
| :--- | :--- | :--- |
| `enabled` | 布尔型 | 插件的总开关。`true` 为开启，`false` 为关闭。 |
| `trigger_keywords` | 列表 | 除了被@之外，哪些关键词可以触发机器人的分析流程。例如：`["机器人", "bot", "小助理"]`。 |
| `decision_making_prompt` | 文本 | **这是插件最核心的配置**。它是一个 Prompt 模板，用于指导 LLM 如何进行决策。您可以修改它来调整机器人的回复倾向和“性格”。模板中必须包含 `{user_message}` 和 `{is_at}` 占位符，并要求 LLM 返回指定格式的 JSON。 |

### 自定义决策 Prompt

默认的 Prompt 已经能够很好地工作，但通过修改它，您可以实现更丰富的效果。例如：

-   **让机器人更热情**：在决策原则中加入“如果用户情绪积极，即使是闲聊也尽量回复”。
-   **让机器人更专业**：在原则中强调“只回复与特定领域（如编程、游戏）相关的问题”。
-   **角色扮演**：完全重写 Prompt，让机器人扮演一个特定的角色（如一位高冷的猫娘、一位严谨的学者），并根据角色的性格来判断是否回复。

## 🖥️ 控制台输出示例

您可以实时监控 AstrBot 的控制台，以了解插件的每一次决策。

**决定回复的场景:**
[Better Auto-Reply] [INFO] 收到潜在相关消息: "机器人，帮我查一下今天的天气"[Better Auto-Reply] [INFO] --- LLM 思考过程 ---[Better Auto-Reply] [INFO] 消息分析: 用户在明确地向机器人发出指令，询问天气信息，这是一个需要回应的有效请求。[Better Auto-Reply] [INFO] 回复意向: 是[Better Auto-Reply] [INFO] LLM 决定回复，正在生成内容...
**决定不回复的场景:**
[Better Auto-Reply] [INFO] 收到潜在相关消息: "哈哈哈，楼上那个机器人笑死我了"[Better Auto-Reply] [INFO] --- LLM 思考过程 ---[Better Auto-Reply] [INFO] 消息分析: 用户只是在第三方视角讨论机器人，并没有直接的互动意图或问题。这更像是一句对其他内容的评论，无需介入。[Better Auto-Reply] [INFO] 回复意向: 否[Better Auto-Reply] [INFO] LLM 决定不回复。
## 🧑‍💻 作者

-   **LumineStory**

## 🔗 仓库地址

[github.com/oyxning/astrtbot_plugin_better_auto_reply](https://github.com/oyxning/astrtbot_plugin_better_auto_reply)

## 💡 另：插件反馈群

由于作者持续的那么一个懒，平常不会及时的看issues，所以开了个QQ反馈群方便用户及时的拷打作者。
* 群号：928985352       
* 进群密码：神人desuwa
